<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language & Legal Assistant</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Landing Page -->
    <div id="landing-page" class="page active">
        <div class="container">
            <div class="hero">
                <div class="globe-icon">🌍</div>
                <h1 class="hero-title">Language & Legal Assistant</h1>
                <p class="hero-subtitle">Break language barriers with instant translation and get legal help based on Indian Constitution</p>
            </div>

            <div class="features">
                <div class="feature-card">
                    <div class="feature-icon">🌐</div>
                    <h3>Instant Translation</h3>
                    <p>Translate text between 12+ languages</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🎤</div>
                    <h3>Voice Support</h3>
                    <p>Speak naturally and get instant translations</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">⚡</div>
                    <h3>Real-time</h3>
                    <p>See translations as you type</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">📱</div>
                    <h3>Simple & Fast</h3>
                    <p>No registration required</p>
                </div>
            </div>

            <button class="btn-primary" onclick="showLanguageSelect()">
                Get Started - Select Your Language
            </button>
            <p class="guest-text">No registration required - Start instantly</p>
        </div>
    </div>

    <!-- Language Selection Page -->
    <div id="language-page" class="page">
        <div class="container">
            <div class="header-badge">
                <span class="badge-icon">🌍</span>
                <span class="badge-text">MultiLingual Assistant</span>
            </div>
            
            <h2 class="page-title">Choose Your Preferred Language</h2>
            <p class="page-subtitle">Select your primary language to personalize your experience. You can change this anytime in settings.</p>
            
            <div class="language-hint">
                <span>🗣️</span>
                <span>Select Language / भाषा चुनें / Seleccionar idioma</span>
            </div>
            <p class="hint-text">Click on your preferred language to continue</p>

            <div class="language-grid" id="language-grid">
                <!-- Languages will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Translation Page -->
    <div id="translate-page" class="page">
        <div class="container">
            <button class="btn-back" onclick="showLanguageSelect()">
                ← Back to Language Selection
            </button>

            <h2 class="page-title">🌍 Translation Tool</h2>
            <p class="page-subtitle">Translate instantly as you type</p>

            <div class="translation-card">
                <div class="translation-grid">
                    <!-- Source -->
                    <div class="translation-column">
                        <label class="input-label">From</label>
                        <select id="source-lang" class="lang-select">
                            <option value="auto">Auto Detect</option>
                        </select>
                        <textarea 
                            id="source-text" 
                            class="translation-textarea"
                            rows="10"
                            placeholder="Enter text to translate..."></textarea>
                        <div class="actions">
                            <button class="icon-btn" onclick="speak('source')" title="Listen">🔊</button>
                            <button class="icon-btn" onclick="copy('source')" title="Copy">📋</button>
                        </div>
                    </div>

                    <!-- Swap Button -->
                    <div class="swap-container">
                        <button class="swap-btn" onclick="swapLanguages()" title="Swap languages">⟲</button>
                    </div>

                    <!-- Target -->
                    <div class="translation-column">
                        <label class="input-label">To</label>
                        <select id="target-lang" class="lang-select">
                        </select>
                        <textarea 
                            id="target-text" 
                            class="translation-textarea readonly"
                            rows="10"
                            readonly
                            placeholder="Translation will appear here..."></textarea>
                        <div class="actions">
                            <button class="icon-btn" onclick="speak('target')" title="Listen">🔊</button>
                            <button class="icon-btn" onclick="copy('target')" title="Copy">📋</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="debug-info">
                <small>API Status: <span id="api-status">Checking...</span></small>
            </div>
        </div>
    </div>

    <script>
        // ⚠️ REPLACE THIS URL WITH YOUR ACTUAL RENDER BACKEND URL
        const API_BASE = 'https://multilingual-api-wxrv.onrender.com';

        const languages = [
            { code: 'en', name: 'English', native: 'English', flag: '🇺🇸' },
            { code: 'hi', name: 'Hindi', native: 'हिन्दी', flag: '🇮🇳' },
            { code: 'es', name: 'Spanish', native: 'Español', flag: '🇪🇸' },
            { code: 'fr', name: 'French', native: 'Français', flag: '🇫🇷' },
            { code: 'de', name: 'German', native: 'Deutsch', flag: '🇩🇪' },
            { code: 'it', name: 'Italian', native: 'Italiano', flag: '🇮🇹' },
            { code: 'pt', name: 'Portuguese', native: 'Português', flag: '🇵🇹' },
            { code: 'ru', name: 'Russian', native: 'Русский', flag: '🇷🇺' },
            { code: 'ja', name: 'Japanese', native: '日本語', flag: '🇯🇵' },
            { code: 'ko', name: 'Korean', native: '한국어', flag: '🇰🇷' },
            { code: 'zh', name: 'Chinese', native: '中文', flag: '🇨🇳' },
            { code: 'ar', name: 'Arabic', native: 'العربية', flag: '🇸🇦' }
        ];

        let selectedTargetLang = 'hi';
        let translationTimeout = null;

        document.addEventListener('DOMContentLoaded', () => {
            populateLanguages();
            setupTranslationPage();
            checkAPIStatus();
        });

        function populateLanguages() {
            const grid = document.getElementById('language-grid');
            grid.innerHTML = languages.map(lang => `
                <div class="language-card" onclick="selectLanguage('${lang.code}')">
                    <div class="language-flag">${lang.flag}</div>
                    <div class="language-name">${lang.name}</div>
                    <div class="language-native">${lang.native}</div>
                </div>
            `).join('');
        }

        function setupTranslationPage() {
            const sourceLangSelect = document.getElementById('source-lang');
            const targetLangSelect = document.getElementById('target-lang');
            
            sourceLangSelect.innerHTML = '<option value="auto">Auto Detect</option>' +
                languages.map(l => `<option value="${l.code}">${l.flag} ${l.name}</option>`).join('');
            
            targetLangSelect.innerHTML = languages.map(l => 
                `<option value="${l.code}">${l.flag} ${l.name}</option>`
            ).join('');
            
            document.getElementById('source-text').addEventListener('input', () => {
                clearTimeout(translationTimeout);
                translationTimeout = setTimeout(translate, 1000);
            });
            
            sourceLangSelect.addEventListener('change', translate);
            targetLangSelect.addEventListener('change', translate);
        }

        function showLanguageSelect() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('language-page').classList.add('active');
        }

        function selectLanguage(langCode) {
            selectedTargetLang = langCode;
            document.getElementById('target-lang').value = langCode;
            showTranslatePage();
        }

        function showTranslatePage() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('translate-page').classList.add('active');
        }

        async function translate() {
            const sourceText = document.getElementById('source-text').value.trim();
            const targetText = document.getElementById('target-text');
            
            if (!sourceText || sourceText.length < 2) {
                targetText.value = '';
                return;
            }
            
            targetText.value = 'Translating...';
            
            const sourceLang = document.getElementById('source-lang').value;
            const targetLang = document.getElementById('target-lang').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/translate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: sourceText,
                        from: sourceLang,
                        to: targetLang
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    targetText.value = data.translatedText;
                } else {
                    targetText.value = 'Translation failed: ' + (data.message || 'Unknown error');
                }
            } catch (error) {
                targetText.value = 'Error: ' + error.message;
                console.error('Translation error:', error);
            }
        }

        function swapLanguages() {
            const sourceLang = document.getElementById('source-lang');
            const targetLang = document.getElementById('target-lang');
            const sourceText = document.getElementById('source-text');
            const targetText = document.getElementById('target-text');
            
            if (sourceLang.value === 'auto') return;
            
            const tempLang = sourceLang.value;
            sourceLang.value = targetLang.value;
            targetLang.value = tempLang;
            
            const tempText = sourceText.value;
            sourceText.value = targetText.value;
            targetText.value = tempText;
            
            translate();
        }

        function speak(type) {
            const text = type === 'source' 
                ? document.getElementById('source-text').value 
                : document.getElementById('target-text').value;
            
            if (!text || !('speechSynthesis' in window)) return;
            
            const utterance = new SpeechSynthesisUtterance(text);
            speechSynthesis.speak(utterance);
        }

        function copy(type) {
            const text = type === 'source'
                ? document.getElementById('source-text').value
                : document.getElementById('target-text').value;
            
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            });
        }

        async function checkAPIStatus() {
            const statusEl = document.getElementById('api-status');
            try {
                const response = await fetch(`${API_BASE}/api/translate/languages`);
                const data = await response.json();
                statusEl.textContent = data.success ? '✅ Connected' : '❌ Error';
                statusEl.style.color = data.success ? 'green' : 'red';
            } catch (error) {
                statusEl.textContent = '❌ Cannot connect to API';
                statusEl.style.color = 'red';
                console.error('API check failed:', error);
            }
        }
    </script>
</body>
</html>
